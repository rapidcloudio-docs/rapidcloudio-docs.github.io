<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Documentation : Rapidcloud Single Page Documentation">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Documentation</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/rapidcloudio-docs">View on GitHub</a>

          <h1 id="project_title">Documentation</h1>
          <h2 id="project_tagline">Rapidcloud Single Page Documentation</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Rapidcloud.io provides Java developers with turnkey application delivery services to the cloud. </p>

<p><a href="#general-overview">General Overview</a> | 
<a href="#networks">Networks</a> | 
<a href="#server-setup">Server Setup</a>  |
<a href="#frameworks">Framework</a>  |
<a href="#quickstart">Quickstart</a> </p>

<h1>
<a name="general-overview" class="anchor" href="#general-overview"><span class="octicon octicon-link"></span></a>General Overview</h1>

<h3>
<a name="initial-setup" class="anchor" href="#initial-setup"><span class="octicon octicon-link"></span></a>Initial Setup</h3>

<p>Get started with rapidcloud by providing access keys to your AWS, Digital Ocean or Rackspace account and authorizing rapidcloud to read your Github or Bitbucket repositories. Once authorized for a cloud service provider can use rapidcloud to provision and configure Java web application servers.</p>

<h3>
<a name="source-code" class="anchor" href="#source-code"><span class="octicon octicon-link"></span></a>Source Code</h3>

<p>After the server is provisioned and setup, you'll need to clone your application repository (from bitbucket or github) onto your cloud server. (Note: Rapidcloud does not keep a copy of your source code on its servers).</p>

<h3>
<a name="compile-and-package" class="anchor" href="#compile-and-package"><span class="octicon octicon-link"></span></a>Compile and Package</h3>

<p>After cloning your application, you will be ready to build and deploy it. Rapidcloud does it's work by connecting to your server and executing the build commands, they are run from <code>/home/rc-build/repository</code>.</p>

<h4>
<a name="play" class="anchor" href="#play"><span class="octicon octicon-link"></span></a>Play</h4>

<p>For play projects, the build step default to <code>sbt clean compile stage -Dsbt.log.noformat=true</code> (note: the noformat prevents the control characters from outputting and making the logs hard to read)</p>

<p>You can override these settings on your server's configuration page, however you'll need to make sure sure your application is packaged to deploy in the  <code>target/universal/stage/</code> folder after execution</p>

<h4>
<a name="mavenwar-projects" class="anchor" href="#mavenwar-projects"><span class="octicon octicon-link"></span></a>Maven/War Projects</h4>

<p>For maven projects, the build step will default to <code>mvn clean package</code>. </p>

<p>You can override these settings on your server's configuration page, however you'll need to make sure a .war file is packaged in the projects target/ folder after execution.</p>

<h3>
<a name="deploy" class="anchor" href="#deploy"><span class="octicon octicon-link"></span></a>Deploy</h3>

<p>Once packaged, rapidcloud will attempt to deploy the projects</p>

<p>Rapidcloud offers two deployment strategies. Parallel deployment and traditional deployment. With parallel deployment enabled rapidcloud will alternate between two ports 8080/8081 for Maven/Tomcat projects and 9000/9001 for Play projects. </p>

<p>The deployment lifecycle works as follows</p>

<ol>
<li>Start the application on the alternate instance (non active port)</li>
<li>Wait for the application start time to complete (adjust the time on the server configuration page)</li>
<li>Verify the application via http at the confirmation url (specified on the server configuration page). If the verifiation url fails to return a 200 status code, stop execution and mark the deployment as failed.</li>
<li>Signal Nginx to send all new requests to the new application instance</li>
<li>Wait 1 minute for existing requests on the old instance to cooldown</li>
<li>Shutdown the old instance</li>
</ol>

<h4>
<a name="play-1" class="anchor" href="#play-1"><span class="octicon octicon-link"></span></a>Play</h4>

<p>For play projects rapidcloud will copy the files in <code>target/universal/stage/</code> to <code>/opt/play/(8000|8001)/</code> and execute the cmd in /opt/play/(8000|8001)/bin to start the application. Command line arguments can be provided on the server configuration page. </p>

<h4>
<a name="tomcat" class="anchor" href="#tomcat"><span class="octicon octicon-link"></span></a>Tomcat</h4>

<p>For play projects rapidcloud will copy the war file in target/ to /opt/tomcat/instances/(8080|8081)/webapps/ and start tomcat</p>

<h4>
<a name="mysql" class="anchor" href="#mysql"><span class="octicon octicon-link"></span></a>MySQL</h4>

<p>If you choose to install MySQL on your server, the database credentials are automatically provided as environment variables to your application. The variables are:</p>

<ul>
<li>DB_NAME=local database name</li>
<li>DB_USER=local database login username</li>
<li>DB_PASSWORD=local database login password</li>
<li>DB_URL=local database jdbc url </li>
</ul>

<h3>
<a name="logging-into-mysql" class="anchor" href="#logging-into-mysql"><span class="octicon octicon-link"></span></a>Logging into MySQL</h3>

<p>Rapidcloud creates an administration account for you to use with the username rc-user. The password for that account
is emailed to you as part of your server setup. To access your database remotely you'll need to ssh into your machine, then use the rc-user database login to access the database. </p>

<p>Conveniently MySQL workbench supports a login over ssh. When you add a connection, specify "Standard TCP/IP over SSH" as the method. Provide the following parameters</p>

<ul>
<li>SSH Username: rc-user</li>
<li>SSH Hostname: (IP Address of your instance)</li>
<li>SSH Key File: The private key which matches the public key you upload to your instance (via ssh page)</li>
<li>MySQL Hostnane: 127.0.0.1</li>
<li>MySQL Server Port: 3306</li>
<li>Username: rc-user</li>
<li>Password: (This password was sent to you via email when server was provisioned)</li>
</ul>

<h2>
<a name="networks" class="anchor" href="#networks"><span class="octicon octicon-link"></span></a>Networks</h2>

<h3>
<a name="network-overview" class="anchor" href="#network-overview"><span class="octicon octicon-link"></span></a>Network Overview</h3>

<p>Networks allow you to share servers across servers automatically, manage firewall/across rules across servers and define one set of environment variables for multiple servers</p>

<h3>
<a name="network-services" class="anchor" href="#network-services"><span class="octicon octicon-link"></span></a>Network Services</h3>

<p>Rapidcloud has three network friendly services, Memcached, Redis and MySQL. For an unnetworked server, access to those services is blocked either by iptables or AWS security groups, only permitting access from the local machine. </p>

<p>When a server is joined to a network, rapidcloud automatically opens the ports to any installed network services up to other members of the network.</p>

<p>If there a Redis or Memcache servers in a network their IP addresses are published as environment variables to all members of the network.</p>

<ul>
<li>NET_REDIS_SERVERS=ipAddress1,ipAddress2</li>
<li>NET_MEMCACHE_SERVERS=ipAddress1,ipAddress2</li>
</ul>

<h3>
<a name="network-database" class="anchor" href="#network-database"><span class="octicon octicon-link"></span></a>Network Database</h3>

<p>Rapidcloud allows you to select one of the MySQL instances on a network as the network DB. Once this is done, the database connection information will be published to all members of the network as environment variables.</p>

<ul>
<li>NET_DB_NAME=name</li>
<li>NET_DB_USER=login username</li>
<li>NET_DB_PASSWORD=login password</li>
<li>NET_DB_URL=jdbc url to the database</li>
</ul>

<h1>
<a name="server-setup" class="anchor" href="#server-setup"><span class="octicon octicon-link"></span></a>Server Setup</h1>

<h3>
<a name="ssh" class="anchor" href="#ssh"><span class="octicon octicon-link"></span></a>SSH</h3>

<p>You can login into your server by uploading a public ssh key from your server's ssh key page. Once that's done, you'll be able to login as rc-user (ssh rc-user@). To execute a command as sudo you'll have to use the sudo password which was emailed to you when your server was provisioned.</p>

<p>Please note, if you install MySQL there will be TWO separate rc-user accounts, one for ssh (and sudo) purposes and one for database administration. </p>

<h3>
<a name="application" class="anchor" href="#application"><span class="octicon octicon-link"></span></a>Application</h3>

<h4>
<a name="play-2" class="anchor" href="#play-2"><span class="octicon octicon-link"></span></a>Play</h4>

<p>Play is located in
<code>/opt/play</code></p>

<p>It is organized into two folders which the deployer switches back and forth between during parallel deployments.</p>

<ul>
<li>/opt/play/9000</li>
<li>/opt/play/9001</li>
</ul>

<p>Each instance has its own log directory</p>

<ul>
<li>/opt/play/9000/logs</li>
<li>/opt/play/9001/logs</li>
</ul>

<p>Standard error and standard out written to </p>

<ul>
<li>/var/log/play/play_9000.err.log</li>
<li>/var/log/play/play_9000.out.log</li>
<li>/var/log/play/play_9001.err.log</li>
<li>/var/log/play/play_9001.out.log</li>
</ul>

<h4>
<a name="tomcat-1" class="anchor" href="#tomcat-1"><span class="octicon octicon-link"></span></a>Tomcat</h4>

<p>Tomcat is located in
<code>/opt/tomcat/</code></p>

<p>It is separated into a home and base for each instance.</p>

<ul>
<li>CATALINA_HOME=/opt/tomcat</li>
<li>CATALINA_BASE=/opt/tomcat/instances/(8080|8081)</li>
</ul>

<p>Each instance has its own log directory</p>

<ul>
<li>/opt/tomcat/instances/8080/log/</li>
<li>/opt/tomcat/instances/8081/log/</li>
</ul>

<p>Standard error and standard out are written to</p>

<ul>
<li>/var/log/tomcat/tomcat_8080.err.log</li>
<li>/var/log/tomcat/tomcat_8080.out.log</li>
<li>/var/log/tomcat/tomcat_8081.err.log</li>
<li>/var/log/tomcat/tomcat_8081.out.log</li>
</ul>

<h3>
<a name="supervisor" class="anchor" href="#supervisor"><span class="octicon octicon-link"></span></a>Supervisor</h3>

<p>Each application is managed by supervisord to insure that it stays running by restarting it automatically if it fails unexpectedly and providing an easy way to manage its launch configuration.</p>

<p>Supervisord config files are located in</p>

<ul>
<li><code>/etc/supervisor/conf.d</code></li>
</ul>

<p>To view the status of supervisor services type</p>

<ul>
<li><code>sudo supervisorctl status</code></li>
</ul>

<p>To restart a service type</p>

<ul>
<li><code>sudo supervisorctl restart &lt;service_name&gt;</code></li>
</ul>

<p>Example:</p>

<ul>
<li><code>sudo supervisorctl restart tomcat_8080</code></li>
<li><code>sudo supervisorctl restart play_9000</code></li>
</ul>

<p>To load a new config file or apply changes made to one</p>

<ul>
<li><code>sudo supervisorctl reread</code></li>
<li><code>sudo supervisorctl reload</code></li>
</ul>

<p>Supervisord also manages</p>

<ul>
<li>nginx - nginx.supervisor.conf</li>
<li>memcached - memcached.supervisor.conf</li>
<li>reds - redis.supervisor.conf</li>
<li>remote_syslog (papertail) - remote_syslog.supervisor.conf</li>
</ul>

<h1>
<a name="frameworks" class="anchor" href="#frameworks"><span class="octicon octicon-link"></span></a>Frameworks</h1>

<h3>
<a name="play-framework-2" class="anchor" href="#play-framework-2"><span class="octicon octicon-link"></span></a>Play! Framework 2</h3>

<p>Rapidcloud supports Play Framework 2 naively using SBT to build the project.</p>

<h3>
<a name="support-for-war-files" class="anchor" href="#support-for-war-files"><span class="octicon octicon-link"></span></a>Support for war files</h3>

<p>Any framework which uses maven to build a war file should work with rapidcloud. </p>

<h3>
<a name="spring-boot" class="anchor" href="#spring-boot"><span class="octicon octicon-link"></span></a>Spring Boot</h3>

<p>To get spring-boot to generate a war file you can modify your pom.xml as follows:</p>

<pre><code>...

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;

...

 &lt;profile&gt;
    &lt;id&gt;webapp&lt;/id&gt;
    &lt;activation&gt;
        &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    &lt;properties&gt;
        &lt;packaging.type&gt;war&lt;/packaging.type&gt;
    &lt;/properties&gt;
&lt;/profile&gt;

...
</code></pre>

<h1>
<a name="quickstart" class="anchor" href="#quickstart"><span class="octicon octicon-link"></span></a>Quickstart</h1>

<h2>
<a name="spring-boot-1" class="anchor" href="#spring-boot-1"><span class="octicon octicon-link"></span></a>Spring Boot</h2>

<p>We have a quickstart springboot project available for forking on Github. Just go to <a href="https://github.com/rapidcloudio-docs/rapidcloudio-quickstart-springboot">https://github.com/rapidcloudio-docs/rapidcloudio-quickstart-springboot</a> and fork it into your own Github account. </p>

<p>Once thats complete you can deploy the application to any of your servers. Once you've provisioned one, go ahead make the following configuration changes:</p>

<h3>
<a name="from-the-repository-page" class="anchor" href="#from-the-repository-page"><span class="octicon octicon-link"></span></a>From the Repository Page</h3>

<ol>
<li>Source: GitHub</li>
<li>Repository Name: rapidcloudio-quickstart-springboot</li>
<li>Repository Branch: master</li>
</ol>

<h3>
<a name="from-the-configure-page" class="anchor" href="#from-the-configure-page"><span class="octicon octicon-link"></span></a>From the Configure Page</h3>

<ol>
<li>Profiles: webapp</li>
</ol>

<p>After you've made those two configuration changes, click deploy now. Once the deployment is done go ahead and view the hello world page, by navigating your browser to your server's IP address (view on the left side informational panel or the server's overview page)</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
